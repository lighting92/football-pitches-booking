@model FootballPitchesBooking.Models.AccountModels.EditReservationModel
@{
    ViewBag.Title = "Chỉnh Sửa Thông Tin Đặt Sân";
    ViewBag.USER = "active";
    var canMod = Model.CanModify;
        
}

<div class="row stadiumstaff-add-field">
    <div class="span12">
        <div class="row">
            @if (Model.HavePermission)
            {
                <div class="span9">
                    <form action="EditReservation?Id=@Model.Id" method="post" class="form-horizontal" enctype="multipart/form-data">
                        <fieldset>
                            <br />
                            <br />
                            <h1>Chỉnh Sửa Thông Tin Đặt Sân
                            </h1>
                            <br />
                            @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
                            {
                                <div class="alert alert-danger">
                                    <p>@Model.ErrorMessage</p>
                                </div>
                            }
                            else if (!string.IsNullOrWhiteSpace(Model.SuccessMessage))
                            {
                                <div class="alert alert-success">@Model.SuccessMessage</div>
                            }
                            <div class="row">
                                <div class="span8">
                                    <legend><span>Thông Tin Người Đặt</span></legend>
                                </div>
                                <div class="span3">
                                    <label>
                                        Tên người đặt
                                     @if (!canMod)
                                     {
                                         <input name="FullName" type="text" placeholder="Tên người đặt" value="@Model.FullName" readonly>
                                     }
                                     else
                                     {
                                         <input name="FullName" type="text" placeholder="Tên người đặt" value="@Model.FullName">
                                     }

                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Số điện thoại
                                         @if (!canMod)
                                         {
                                             <input name="PhoneNumber" type="text" placeholder="Số điện thoại" value="@Model.PhoneNumber" readonly>
                                         }
                                         else
                                         {
                                             <input name="PhoneNumber" type="text" placeholder="Số điện thoại" value="@Model.PhoneNumber">
                                         }

                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        E-Mail
                                         @if (!canMod)
                                         {
                                             <input name="Email" type="text" placeholder="E-Mail" value="@Model.Email" readonly>
                                         }
                                         else
                                         {
                                             <input name="Email" type="text" placeholder="E-Mail" value="@Model.Email">
                                         }

                                    </label>
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="span8">
                                    <legend><span>Thông Tin Sân</span></legend>
                                </div>
                                <div class="span3">
                                    <label>
                                        Tên sân
                                        <input type="text" value="@Model.StadiumName" readonly />
                                    </label>
                                </div>
                                <div class="span6">
                                    <label>
                                        Địa chỉ sân
                                        <input class="span6" type="text" value="@Model.StadiumAddress" readonly />
                                    </label>
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="span8">
                                    <legend><span>Thông Tin Đặt Sân</span></legend>
                                </div>
                                <div class="span3">
                                    <label>
                                        Sân số
                                        <input type="text" value="@Model.FieldNumber" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Kiểu sân
                                        <input type="text" value="@Model.FieldType người" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Ngày đặt
                                        <input type="text" value="@Model.CreateDate" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Ngày đá
                                        <input type="text" value="@Model.StartDate" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Giờ bắt đầu
                                        <input type="text" value="@Model.StartTime" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Thời lượng
                                        <input type="text" value="@Model.Duration" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Giá
                                        <input class="format-price" type="text" value="@Model.Price" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Chiết khấu
                                        <input class="format-price" type="text" value="@Model.Discount" readonly />
                                    </label>
                                </div>
                                <div class="span3">
                                    <label>
                                        Mã xác nhận
                                        <input type="text" value="@Model.VerifyCode" readonly />
                                    </label>
                                </div>

                                <div class="span3">
                                    <label>
                                        Trạng thái đặt sân
                                        @if (Model.Status.ToLower().Equals("approved"))
                                        {
                                            <input type="text" value="Đã xác nhận" readonly />
                                        }
                                        else if (Model.Status.ToLower().Equals("denied"))
                                        {
                                            <input type="text" value="Bị từ chối" readonly />
                                        }
                                        else if (Model.Status.ToLower().Equals("pending"))
                                        {
                                            <input type="text" value="Đang chờ xét" readonly />
                                        }
                                        else if (Model.Status.ToLower().Equals("canceled"))
                                        {
                                            <input type="text" value="Đã bị hủy" readonly />
                                        }
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="span8">
                                    <legend><span>Giao Hữu</span></legend>
                                </div>
                                <div class="span8 alert" style="display:none" id="reportMessage">
                                </div>
                                <div class="span3">
                                    <label>
                                        Cần đội giao hữu                                        
                                    @if (Model.NeedRival)
                                    {
                                        if (!canMod)
                                        {
                                        <input type="checkbox" name="NeedRival" checked="checked" disabled="disabled" />
                                        }
                                        else
                                        {
                                        <input type="checkbox" name="NeedRival" checked="checked" />
                                        }
                                    }
                                    else
                                    {
                                        if (!canMod)
                                        {
                                        <input type="checkbox" name="NeedRival" disabled="disabled" />
                                        }
                                        else
                                        {
                                        <input type="checkbox" name="NeedRival" />
                                        }
                                    }
                                    </label>
                                </div>
                                @if (!string.IsNullOrEmpty(@Model.RivalName))
                                {
                                    <div class="span3">
                                        <label>
                                            Trạng thái yêu cầu giao hữu
                                        @if (!canMod)
                                        {
                                            <select name="RivalStatus" data-cur="@Model.RivalStatus" disabled="disabled">
                                                <option value="Pending">Đang chờ duyệt</option>
                                                <option value="Approve">Chấp nhận</option>
                                                <option value="Deni">Từ chối</option>
                                            </select>
                                        }
                                        else
                                        {
                                            if (!string.IsNullOrEmpty(Model.RivalStatus) && Model.RivalStatus.ToLower().Equals("approve"))
                                            {
                                            <select name="RivalStatus" data-cur="@Model.RivalStatus" disabled="disabled">
                                                <option value="Pending">Đang chờ duyệt</option>
                                                <option value="Approve">Chấp nhận</option>
                                                <option value="Deni">Từ chối</option>
                                            </select>
                                            }
                                            else
                                            {
                                            <select name="RivalStatus" data-cur="@Model.RivalStatus">
                                                <option value="Pending">Đang chờ duyệt</option>
                                                <option value="Approve">Chấp nhận</option>
                                                <option value="Deni">Từ chối</option>
                                            </select>
                                            }
                                        }
                                        </label>
                                    </div>
                                        if (!canMod && Model.Status.ToLower().Equals("approved"))
                                        {
                                    <div class="span3">
                                        <label>
                                            &nbsp
                                            </label>
                                        <button class="btn-medium btn-report" onclick="reportRival()" type="button">Báo đối thủ không đến</button>
                                    </div>
                                        }
                                        else
                                        {
                                    <div class="span3" style="visibility: hidden">
                                        <label>
                                            &nbsp
                                        <input type="text" />
                                        </label>
                                    </div>
                                        }                                    
                                    <div class="span3">
                                        <label>
                                            Tên đối thủ
                                        <input type="text" value="@Model.RivalName" readonly />
                                        </label>
                                    </div>
                                    <div class="span3">
                                        <label>
                                            Số điện thoại đối thủ
                                        <input type="text" value="@Model.RivalPhone" readonly />
                                        </label>
                                    </div>
                                    <div class="span3">
                                        <label>
                                            Email đối thủ
                                        <input type="text" value="@Model.RivalEmail" readonly />
                                        </label>
                                    </div>
                                }
                                else if (Model.NeedRival)
                                {
                                    <div class="span9" style="text-align: center">
                                        Hiện tại chưa có đội nào nhận lời mời giao hữu
                                    </div>
                                }
                            </div>
                            <br />
                            <div class="row">
                                <div class="span3">
                                    @if (!canMod)
                                    {
                                        <button disabled="disabled" type="button" onclick="window.location='/Account/CancelReservation?Id=@Model.Id'" class="btn btn-primary book-now btn-medium btn-auto span3">Hủy Đặt Sân</button>
                                    }
                                    else
                                    {
                                        <button type="button" onclick="window.location='/Account/CancelReservation?Id=@Model.Id'" class="btn btn-primary book-now btn-medium btn-auto span3">Hủy Đặt Sân</button>
                                    }
                                </div>
                                <div class="span3">
                                    @if (!canMod)
                                    {
                                        <button disabled="disabled" type="submit" class="btn btn-primary book-now btn-medium btn-auto span3">Lưu</button>
                                    }
                                    else
                                    {
                                        <button type="submit" class="btn btn-primary book-now btn-medium btn-auto span3">Lưu</button>
                                    }
                                </div>
                                <div class="span3">
                                    <button type="button" onclick="window.location='/Account/BookingHistory'" class="btn btn-primary book-now btn-medium btn-auto span3">Huỷ bỏ</button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>               
            }
            else
            {
                <h3>@Model.ErrorMessage</h3>
            }
        </div>
    </div>
</div>
<script type="text/javascript">
    var waiting = false;
    function reportRival() {
        if (!waiting) {
            jQuery.ajax({
                url: "/Report/Rival/@Model.Id",
                type: "POST",
                success: function (data) {
                    var success = data.lastIndexOf("SUCCESS::");
                    var message = data.substring(data.lastIndexOf("::") + 2, data.length);
                    if (success >= 0) {
                        jQuery("#reportMessage").removeClass("alert-danger");
                        jQuery("#reportMessage").addClass("alert-success");
                    }
                    else {
                        jQuery("#reportMessage").removeClass("alert-success");
                        jQuery("#reportMessage").addClass("alert-danger");
                    }
                    jQuery("#reportMessage").html(message);
                    jQuery("#reportMessage").css("display", "block");
                }
            });
        }
    }
    $(document).ready(function () {
        $(".format-price").priceFormat({
            prefix: '',
            centsLimit: 0
        });
        $.each($("select"), function (index, obj) {
            $(obj).val($(obj).data("cur"));
        });
    });
</script>
